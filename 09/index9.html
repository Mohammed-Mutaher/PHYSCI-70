<!DOCTYPE html>
<html>
<title>Mohammed Mutaher - PHYSCI 70</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../mystyle.css">

<body class="w3-pale-yellow w3-content" style="max-width:1600px">

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:225px;" id="mySidebar"><br>
  <div class="w3-container">
    <a href="#" onclick="w3_close()" class="w3-hide-large w3-right w3-jumbo w3-padding w3-hover-grey" title="close menu">
      <i class="fa fa-remove"></i>
    </a>
    <img src="../Pfp.png" 
      style="object-fit:cover;
        object-position: center;
            width:62px;
            height:62px"
      class="w3-round"><br><br>
    <h4><b>Navigation</b></h4>
  </div>
  <div class="w3-bar-block">
    <a href="https://mohammed-mutaher.github.io/PHYSCI-70/" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-th-large fa-fw w3-margin-right"></i>Home</a> 
    <a href="../about.html" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-user fa-fw w3-margin-right"></i>About Me</a>
    <a href="https://nathanmelenbrink.github.io/ps70/" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-gears fa-fw w3-margin-right"></i>About PHYSCI 70</a>
  </div>
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:250px">

<!-- Header -->
  <header id="Week 9">
    <a href="#"><img src="/w3images/avatar_g2.jpg" style="width:65px;" class="w3-circle w3-right w3-margin w3-hide-large w3-hover-opacity"></a>
    <span class="w3-button w3-hide-large w3-xxlarge w3-hover-text-grey" onclick="w3_open()"><i class="fa fa-bars"></i></span>
    <div class="w3-container">
    <div class="w3-section w3-padding-10">
    <h1><b>Week 9: Radio, Wi-Fi, Bluetooth (IoT)</b></h1>
    <div class="w3-section w3-bottombar w3-border-white w3-padding-10"> </div>
    </div>
  </header>

<!-- Body -->
<div class="w3-margin-left">
  <body id="Text">
    <div class="w3-container">
    <div class="w3-section w3-padding-10">

      <h5><p> 

      <p> This week, we focused on radio, Wi-Fi, and Bluetooth (IoT). </p>

      <p> We were tasked with demonstrating communication between a microcontroller and another device. I completed the assignment by following two tutorials, one on the PHYSCI 70 website by Rob Hart and the other on randomnerdtutorials.com by Rui Santos. Documentation for both projects is provided below. </p>

      <br>

      <p><h3><b> Project 1: Communicating with UART Serial </b></h3></p>

      <p> I followed the tutorial linked <a href="https://roberthart56.github.io/SCFAB/SC_lab/Networking/networking/USART/index.html">here</a> to facilitate communication between the Adafruit Metro microcontroller and an ESP32-based Feather board. The goal was to have a potentiometer connected to the microcontroller, which would communicate with the ESP32 board to control the position of a servo motor connected to the latter. </p>

      <p> On my first attempt, I replicated the wiring setup in the tutorial and tried to upload the code for both the Metro and ESP32 board provided in the tutorial. The wiring setup and code from the tutorial are shown below. </p>


      <p> Wiring setup: </p>

      <img src="./Wiresetup1.jpg" width="50%" alt="" class="center">

      <p> Metro microcontroller code: </p>

      <pre><code class="language-arduino">
        //Code to transmit
        //Microcontroller has a potentiometer input:  wiper pin attached to analog in.
        //Sends a signal to receiver through the USART transmit pin (TX)  (or TX1 for some boards)

        //Can receive  a signal throught the USART receive pin (RX), but this is not
        // implemented in this simplest sketch.

        //The wired-together devices must share a common ground!

        const int pot_pin = A0;

        void setup() {
          Serial.begin(0);        //for the USB serial devices, this baud rate is meaningless - can be "0"
          Serial1.begin(9600);      //this is the USART SERIAL.  On SAM boards, like Metro M0, ItsyBitsy and D11, this is called "Serial1". Baud rate is important on this one!           
        }

        void loop() {
        int pot_value = analogRead(pot_pin);
        Serial.println(pot_value);          //This is for diagnostic purposes
        Serial1.write(pot_value/4);     //This one is data sent to the other board.  divide by four to make the range 0-255.
        delay(10);
        }
      </code></pre>

      <p> ESP32 board code: </p>

      <pre><code class="language-arduino">
        //Code to move a servomotor in response to a change in input pin.
        //Use as a simple example of receiving for a wired network 3/30/20.  Rob Hart.
        //modified to use with ESP32 Huzzah board July 2020. R.Hart

        #include <ESP32Servo.h>

        Servo myservo;  // create servo object to control a servo

        void setup() {
          myservo.attach(21);  // attaches the servo on pin 9 to the servo object
          Serial.begin(9600);        //for the USB serial devices, this baud rate is meaningless - can be "0"
          Serial1.begin(9600);      //this is the USART SERIAL.  On SAM boards, like ItsyBitsy and D11, this is called "Serial1"
          //Baud rate is important on this one!
        }

        void loop() {
          while (!Serial1.available()) {      //wait until serial from UART is available.
          }

          byte rec_byte =  Serial1.read();    //Here is where the incoming byte is read.
          //Serial.println(rec_byte);       //for diagnosing using USB serial
          int degree = rec_byte*180/255;      //conversion between one byte and 180 degrees.
          Serial.println(degree);           //for diagnosing using USB serial
          myservo.write(degree);
        }
      </code></pre>

      <br>

      <p> The code for the microcontroller and the ESP32 board would not upload and the program instead returned error messages for both. First, I focused on the microcontroller code. I quickly realized that the tutorial uses an Adafruit Metro Express microcontroller, which has two serial ports versus the microcontroller I was using, which only has one. Due to the fact that there was no "Serial1" on my board, the code would not upload without an error. So, I deleted the "Serial1.begin(9600);" line under void setup(){} and replaced the "Serial1.write(pot_value/4);" line under void loop(){} with "Serial.write(pot_value/4);". I also commented out the "Serial.println(pot_value);" line in the code. Having made these changes, I also changed the wiring so that instead of one signal wire connecting the TX1 pin on the microcontroller to the RX/16 pin on the ESP32 board, there were two wires (one connecting the microcontroller TX1 pin to the RX/16 pin on the ESP32 board and the other connecting the microcontroller RX0 pin to the TX/17 pin on the ESP32 board). </p>

      <p> With respect to the code for the ESP32 board, I realized that the issue was the use of the ESP32Servo.h library. I downloaded the ESP32 Arduino Servo Library linked <a href="https://github.com/RoboticsBrno/ServoESP32">here</a> and replaced the "#include &lt;ESP32Servo.h&gt;" line in the original code with "#include &lt;Servo.h&gt;". This fixed the uploading issue, and with that I was ready to test the device. The modified wiring setup and code are shown below. </p>

     
      <p> Modified wiring setup: </p>

      <img src="./Wiresetup2.jpg" width="50%" alt="" class="center">

      <p> Modified Metro microcontroller code: </p>

      <pre><code class="language-arduino">
        //Code to transmit
        //Microcontroller has a potentiometer input:  wiper pin attached to analog in.
        //Sends a signal to receiver through the USART transmit pin (TX)  (or TX1 for some boards)

        //Can receive  a signal throught the USART receive pin (RX), but this is not
        // implemented in this simplest sketch.

        //The wired-together devices must share a common ground!

        const int pot_pin = A0;

        void setup() {
          Serial.begin(9600);   
        }

        void loop() {
        int pot_value = analogRead(pot_pin);
        //Serial.println(pot_value);          //This is for diagnostic purposes
        Serial.write(pot_value/4);     //This one is data sent to the other board.  divide by four to make the range 0-255.
        delay(10);
        }
      </code></pre>

      <p> Modified ESP32 board code: </p>

      <pre><code class="language-arduino">
        //Code to move a servomotor in response to a change in input pin.
        //Use as a simple example of receiving for a wired network 3/30/20.  Rob Hart.
        //modified to use with ESP32 Huzzah board July 2020. R.Hart

        #include <Servo.h>

        Servo myservo;  // create servo object to control a servo

        void setup() {
          myservo.attach(21);  // attaches the servo on pin 9 to the servo object
          Serial.begin(9600);        //for the USB serial devices, this baud rate is meaningless - can be "0"
          Serial1.begin(9600);      //this is the USART SERIAL.  On SAM boards, like ItsyBitsy and D11, this is called "Serial1"
          //Baud rate is important on this one!
        }

        void loop() {
          while (!Serial1.available()) {      //wait until serial from UART is available.
          }

          byte rec_byte =  Serial1.read();    //Here is where the incoming byte is read.
          //Serial.println(rec_byte);       //for diagnosing using USB serial
          int degree = rec_byte*180/255;      //conversion between one byte and 180 degrees.
          Serial.println(degree);           //for diagnosing using USB serial
          myservo.write(degree);
        }
      </code></pre>

      <p> Video: </p>

      <div class="w3-center">
        <video width="400" height="300" controls>
        <source src="./Test1.mp4" type=video/mp4>
        </video>
      </div>

      <p> As you can see in the pictures and video above, I powered both the Metro microcontroller and ESP32 separately using USB cables connected to my laptop. I also wanted to see if the microcontroller could be used to power the ESP32 board. I first tried connecting the 3.3V pin on the microcontroller to the 3V pin on the ESP32 board without success. After looking at the pinout diagram of the ESP32 board, I noticed that there was a USB pin. I promptly connected the 5V pin from the microcontroller to the USB pin on the ESP32 board, and it powered on. </p>

      <div class="row">
        <div class="column2">
          <p> Wiring setup: </p>
          <img src="./Wiresetup3.jpg" alt="" style="width:100%"> </p>
        </div>
        <div class="column2">
          <p> Video: </p>
          <video style="width:100%" controls>
          <source src="./Test2.mp4" type=video/mp4>
          </video> </p>
        </div>
      </div> 

      <br>

      <p><h3><b> Project 2: ESP32 Servo Motor Web Server with Arduino IDE </b></h3></p>

      <p> For my second project, I followed the tutorial linked <a href="https://randomnerdtutorials.com/esp32-servo-motor-web-server-arduino-ide/">here</a> to facilitate communication between the ESP32 board and a servo motor through a web server. The goal was to have a slider on the web server to control the position of the servo motor (between 0º and 180º) using a pulse width modulation (PWM) signal. </p>

      <p> I attached the servo motor to the 13/A12 pin on the ESP32 board and uploaded the code from the tutorial (linked <a href="https://raw.githubusercontent.com/RuiSantosdotme/ESP32-Course/master/code/Servo/WiFi_Web_Server_Servo/WiFi_Web_Server_Servo.ino">here</a>) to it after substituting the wifi name and password for "REPLACE_WITH_YOUR_SSID" and "REPLACE_WITH_YOUR_PASSWORD". I then copied the code from the tutorial (linked <a href="https://raw.githubusercontent.com/RuiSantosdotme/ESP32-Course/master/code/Servo/slider.html">here</a>) into a new Sublime Text file and saved it as an HTML file. You can also use Notepad for this step if you want! For a detailed breakdown of the code, please refer to the tutorial. </p>

      <p> After uploading the code onto the ESP32 board, I opened the serial monitor at a baud rate of 115200 and took note of the IP address it returned (192.168.0.180). Here is a screenshot of the Arduino IDE and serial monitor with the IP address boxed in red: </p>

      <img src="./Screenshot.png" width="200%" alt="" class="center">

      <p> I entered the IP address into my browser and the webpage I created popped up with the slider. Here is a picture of the setup and a video of the project in action: </p>

      <div class="row">
        <div class="column2">
          <p> Wiring setup: </p>
          <img src="./Wiresetup4.jpg" alt="" style="width:100%"> </p>
        </div>
        <div class="column2">
          <p> Video: </p>
          <video style="width:100%" controls>
          <source src="./Servo_slider_test.mp4" type=video/mp4>
          </video> </p>
        </div>
      </div> 

      <p> Both projects were really neat! Now I know how to communicate with UART serial and how to control a servo through a microcontroller via input from a web server. </p>

      <p> And that is all for this week. Thank you! </p>

      </p></h5>

    </div>  
    </div>    
  </body>
</div>

<div class="w3-row-padding w3-padding-large w3-pale-yellow" style="margin-bottom:32px">

  <div class="w3-clear nextprev">
    <a class="w3-button w3-black w3-left" href="../08/index8.html"><i class="fa fa-chevron-left w3-margin-right"></i>Previous</a>
    <a class="w3-button w3-black w3-right" style="margin-right:25px" href="../10/index10.html">Next<i class="fa fa-chevron-right w3-margin-left"></i></a>
  </div>
</div>

</div>
  <div class="w3-center w3-padding w3-black" style="margin-left:225px"><p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></p><p>Mohammed Mutaher 2022</p></div>
</div>

</html>